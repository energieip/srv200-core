{
    "swagger": "2.0",
    "info": {
        "description": "GTB server API",
        "version": "1.0",
        "title": "GTB Swagger",
        "termsOfService": "http://swagger.io/terms/",
        "contact": {
            "email": "developer@energie-ip.com"
        },
        "license": {
            "name": "Apache 2.0",
            "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
        }
    },
    "tags":[
        {
            "name": "setup",
            "description": "GTB configuration: setup config"
        },
        {
            "name": "project",
            "description": "GTB configuration: project config"
        },
        {
            "name": "event",
            "description": "GTB configuration: project config"
        },
        {
            "name": "command",
            "description": "Drivers and groups control"
        },
        {
            "name": "status",
            "description": "Drivers and groups status"
        }
    ],
    "schemes":[
        "http"
    ],
    "paths":{
        "/setup/sensor/{mac}":{
            "get":{
                "tags":[
                    "setup"
                ],
                "summary": "Return Sensor Setup configuration",
                "description": "Return Sensor Setup configuration",
                "operationId": "getSensorSetup",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "mac",
                        "in": "path",
                        "description": "Sensor Mac address",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successfull operation",
                        "schema":{
                            "$ref": "#/definitions/SensorSetup"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },        
        "/setup/sensor":{
            "post":{
                "tags":[
                    "setup"
                ],
                "summary": " Sensor Setup configuration",
                "description": "Sensor Setup configuration",
                "operationId": "setSensorSetup",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "sensor",
                        "in": "body",
                        "description": "Sensor config",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/SensorSetup"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successfull operation",
                        "schema":{
                            "$ref": "#/definitions/SensorSetup"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },
        "/setup/led/{mac}":{
            "get":{
                "tags":[
                    "setup"
                ],
                "summary": "Return LED Setup configuration",
                "description": "Return LED Setup configuration",
                "operationId": "getLedSetup",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "mac",
                        "in": "path",
                        "description": "Led Mac address",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successfull operation",
                        "schema":{
                            "$ref": "#/definitions/LedSetup"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },        
        "/setup/led":{
            "post":{
                "tags":[
                    "setup"
                ],
                "summary": "LED Setup configuration",
                "description": "LED Setup configuration",
                "operationId": "setLedSetup",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "led",
                        "in": "body",
                        "description": "led config",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/LedSetup"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successfull operation",
                        "schema":{
                            "$ref": "#/definitions/LedSetup"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },
        "/setup/group/{groupID}":{
            "get":{
                "tags":[
                    "setup"
                ],
                "summary": "Return Group Setup configuration",
                "description": "Return Group Setup configuration",
                "operationId": "getGroupSetup",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "groupID",
                        "in": "path",
                        "description": "Group Number",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successfull operation",
                        "schema":{
                            "$ref": "#/definitions/GroupSetup"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },
        "/setup/group":{
            "post":{
                "tags":[
                    "setup"
                ],
                "summary": "Group Setup configuration",
                "description": "Group Setup configuration",
                "operationId": "setGroupSetup",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "group",
                        "in": "body",
                        "description": "Group config",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/GroupSetup"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successfull operation",
                        "schema":{
                            "$ref": "#/definitions/GroupSetup"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },
        "/setup/switch/{mac}":{
            "get":{
                "tags":[
                    "setup"
                ],
                "summary": "Return Switch Setup configuration",
                "description": "Return Switch Setup configuration",
                "operationId": "getSwitchSetup",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "mac",
                        "in": "path",
                        "description": "Switch Mac address",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successfull operation",
                        "schema":{
                            "$ref": "#/definitions/SwitchSetup"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },
        "/setup/switch":{
            "post":{
                "tags":[
                    "setup"
                ],
                "summary": "Switch Setup configuration",
                "description": "Switch Setup configuration",
                "operationId": "setSwitchSetup",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "switch",
                        "in": "body",
                        "description": "Switch config",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/SwitchSetup"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successfull operation",
                        "schema":{
                            "$ref": "#/definitions/SwitchSetup"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },
        "/events":{
            "get":{
                "tags":[
                    "status"
                ],
                "summary": "Websocket for Sensor event Status",
                "description": "pop sensor event",
                "operationId": "events",
                "produces":[
                    "application/json"
                ],
                "parameters":[],
                "responses": {
                    "101": {
                        "description": "successful operation",
                        "schema":{
                            "$ref": "#/definitions/Event"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                      }
                }
            }
        },
        "/sensor/{mac}": {
            "get": {
                "tags": [
                    "status"
                ],
                "summary": "Return Sensor Status",
                "description": "Return the given sensor status",
                "operationId": "getSensorStatus",
                "produces":[
                    "application/json"
                ],
                "parameters":[{
                    "name": "mac",
                    "in": "path",
                    "description": "Sensor Mac address",
                    "required": true,
                    "type": "string"
                }],
                "responses": {
                    "200": {
                        "description": "successful operation",
                        "schema":{
                            "$ref": "#/definitions/SensorStatus"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                      }
                }
            },
            "post": {
                "tags": [
                    "config"
                ],
                "summary": "Set Sensor Config",
                "description": "Return the given sensor status",
                "operationId": "setSensor",
                "produces":[
                    "application/json"
                ],
                "consumes": [
                    "application/json"
                ],
                "parameters": [
                    {
                        "name": "mac",
                        "in": "path",
                        "description": "Sensor Mac address",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "sensor",
                        "in": "body",
                        "description": "Sensor config",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/SensorStatus"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successful operation",
                        "schema":{
                            "$ref": "#/definitions/SensorStatus"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    }
                }
            }
        },
        "/leds":{
            "get":{
                "tags":[
                    "status"
                ],
                "summary": "Return LED Status",
                "description": "Return the list of leds status with filter",
                "operationId": "getLedsStatus",
                "produces":[
                    "application/json"
                ],
                "parameters":[
                    {
                        "name": "status",
                        "in": "query",
                        "description": "Status values that need to be considered for filter",
                        "required": false,
                        "type": "array",
                        "items": {
                            "type": "string",
                            "enum": [
                                "all",
                                "isConfigured",
                                "group"
                            ],
                            "default": "all"
                        },
                        "collectionFormat": "multi"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "successful operation",
                        "schema":{
                            "$ref": "#/definitions/LedsStatus"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                      }
                }
            }
        },
        "/led/{mac}":{
            "get":{
                "tags":[
                    "status"
                ],
                "summary": "Return Led Status",
                "description": "Return the given LED status",
                "operationId": "getLedStatus",
                "produces":[
                    "application/json"
                ],
                "parameters":[{
                    "name": "mac",
                    "in": "path",
                    "description": "LED Mac address",
                    "required": true,
                    "type": "string"
                }],
                "responses": {
                    "200": {
                        "description": "successful operation",
                        "schema":{
                            "$ref": "#/definitions/LedStatus"
                        }
                    },
                    "default": {
                        "description": "unexpected error",
                        "schema": {
                          "$ref": "#/definitions/Error"
                        }
                      }
                }
            }
        }
    },
    "definitions": {
        "SensorSetup":{
            "type": "object",
            "required": [
                "mac"
            ],
            "properties": {
                "mac": {
                    "type": "string",
                    "description": "Sensor mac address"
                },
                "group": {
                    "type": "integer",
                    "description": "Associate group"
                },
                "isBleEnabled": {
                    "type": "boolean",
                    "description": "bluetooth activation"
                },
                "brigthnessCorrectionFactor": {
                    "type": "integer",
                    "description": "Brightness correction factor"
                },
                "friendlyName": {
                    "type": "string",
                    "description": "Sensor FriendlyName"
                },
                "thresoldPresence": {
                    "type": "integer",
                    "description": "Thresold presence"
                },
                "temperatureOffset": {
                    "type": "integer",
                    "description": "Temperature offset correction"
                }
            }
        },
        "LedSetup":{
            "type": "object",
            "required": [
                "mac",
                "iMax"
            ],
            "properties": {
                "mac": {
                    "type": "string",
                    "description": "Sensor mac address"
                },
                "group": {
                    "type": "integer",
                    "description": "Associate group"
                },
                "isBleEnabled": {
                    "type": "boolean",
                    "description": "bluetooth activation"
                },
                "iMax": {
                    "type": "integer",
                    "description": "iMax"
                },
                "auto": {
                    "type": "boolean",
                    "description": "Automatic mode"
                },
                "watchdog": {
                    "type": "integer",
                    "description": "watchdog in second"
                },
                "thresoldLow": {
                    "type": "integer",
                    "description": "Thresold low"
                },
                "thresoldHigh": {
                    "type": "integer",
                    "description": "Thresold high"
                },
                "friendlyName": {
                    "type": "string",
                    "description": "Sensor FriendlyName"
                }
            }
        },
        "SwitchSetup":{
            "type": "object",
            "required": [
                "mac"
            ],
            "properties": {
                "mac": {
                    "type": "string",
                    "description": "Sensor mac address"
                },
                "cluster": {
                    "type": "integer",
                    "description": "Associate Cluster number"
                },
                "ip": {
                    "type": "string",
                    "description": "Switch IP address"
                },
                "friendlyName": {
                    "type": "string",
                    "description": "Sensor FriendlyName"
                }
            }
        },
        "GroupRule":{
            "type": "object",
            "properties": {
                "brightness": {
                    "type": "integer",
                    "description": "Brigthness in Lux"
                },
                "Presence": {
                    "type": "integer",
                    "description": "Presence in Second"
                }
            }
        },
        "GroupSetup":{
            "type": "object",
            "required": [
                "group"
            ],
            "properties": {
                "group": {
                    "type": "integer",
                    "description": "Associate group"
                },
                "auto": {
                    "type": "boolean",
                    "description": "Automatic mode"
                },
                "watchdog": {
                    "type": "integer",
                    "description": "watchdog in second"
                },
                "slopeStart": {
                    "type": "integer",
                    "description": "slopeStart in second"
                },
                "slopeStop": {
                    "type": "integer",
                    "description": "slopeStop in second"
                },
                "sensorRule": {
                    "type": "string",
                    "enum": [
                        "average",
                        "min",
                        "max"
                    ],
                    "default": "average",
                    "description": "Rule when multiple sensors are presents in the same group"
                },
                "correctionInterval": {
                    "type": "integer",
                    "description": "correctionInterval in second"
                },
                "leds": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Array of LED mac addresses"
                },
                "sensors": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Array of Sensor mac addresses"
                },
                "groupRules": {
                    "$ref": "#/definitions/GroupRule"
                },
                "friendlyName": {
                    "type": "string",
                    "description": "Sensor FriendlyName"
                }
            }
        },
        "SensorsStatus": {
            "type": "object",
            "required": [
                "mac"
            ],
            "properties": {
                "mac": {
                    "type": "string",
                    "description": "Sensor mac address"
                },
                "sensor": {
                    "$ref": "#/definitions/SensorStatus"
                }
            }
        },
        "Event": {
            "type": "object",
            "required": [
                "eventType"
            ],
            "properties": {
                "eventType": {
                    "type": "string",
                    "description": "event category add|update|remove"
                },
                "driverType": {
                    "type": "string",
                    "description": "driver category sensor|LED"
                },
                "sensor": {
                    "$ref": "#/definitions/Status"
                }
            }
        },
        "LedsStatus": {
            "type": "object",
            "required": [
                "mac"
            ],
            "properties": {
                "mac": {
                    "type": "string",
                    "description": "LED mac address"
                },
                "led": {
                    "$ref": "#/definitions/LedStatus"
                }
            }
        },
        "SensorStatus": {
            "type": "object",
            "required": [
                "mac"
            ],
            "properties": {
                "mac": {
                    "type": "string",
                    "description": "Sensor mac address"
                },
                "id": {
                    "type": "string"
                },
                "ip": {
                    "type": "string",
                    "description": "Sensor IP address"
                },
                "group": {
                    "type": "integer",
                    "description": "Associate group"
                },
                "protocol": {
                    "type": "string",
                    "description": "Sensor communication protocol"
                },
                "topic": {
                    "type": "string",
                    "description": "Sensor communication topic"
                },
                "switchMac": {
                    "type": "string",
                    "description": "Associate switch mac address"
                },
                "isConfigured": {
                    "type": "boolean",
                    "description": "Is the sensor configured"
                },
                "softwareVersion": {
                    "type": "number",
                    "format": "float32",
                    "description": "Sensor Software version"
                },
                "hardwareVersion": {
                    "type": "string",
                    "description": "Sensor Hardware version"
                },
                "isBleEnabled": {
                    "type": "boolean",
                    "description": "Is the bluetooth activate"
                },
                "temperature": {
                    "type": "integer",
                    "description": "Temperature"
                },
                "error": {
                    "type": "integer",
                    "description": "Error code value: 0 means no error"
                },
                "resetNumbers": {
                    "type": "integer",
                    "description": "Number of reset"
                },
                "initialSetupDate": {
                    "type": "number",
                    "format": "float64",
                    "description": "First installation date"
                },
                "lastResetDate": {
                    "type": "number",
                    "format": "float64",
                    "description": "Last reset date"
                },
                "brightness": {
                    "type": "integer",
                    "description": "Corrected Brightness in Lux"
                },
                "presence": {
                    "type": "boolean",
                    "description": "Presence"
                },
                "brigthnessCorrectionFactor": {
                    "type": "integer",
                    "description": "Brightness correction factor"
                },
                "thresoldPresence": {
                    "type": "integer",
                    "description": "Thresold presence"
                },
                "temperatureOffset": {
                    "type": "integer",
                    "description": "Temperature offset correcion"
                },
                "brigthnessRaw": {
                    "type": "integer",
                    "description": "Brigthness Raw value in Lux"
                },
                "lastMovement": {
                    "type": "integer",
                    "description": "Last Movement date"
                },
                "voltageInput": {
                    "type": "integer",
                    "description": "Input voltage"
                },
                "temperatureRaw": {
                    "type": "integer",
                    "description": "Temperature Raw value"
                },
                "friendlyName": {
                    "type": "string",
                    "description": "Sensor FriendlyName"
                }
            }
        },
        "Status": {
            "type": "object",
            "required": [
                "mac"
            ],
            "properties": {
                "mac": {
                    "type": "string",
                    "description": "Mac address"
                },
                "id": {
                    "type": "string"
                },
                "ip": {
                    "type": "string",
                    "description": "IP address"
                },
                "group": {
                    "type": "integer",
                    "description": "Associate group"
                },
                "protocol": {
                    "type": "string",
                    "description": "communication protocol"
                },
                "topic": {
                    "type": "string",
                    "description": "communication topic"
                },
                "switchMac": {
                    "type": "string",
                    "description": "Associate switch mac address"
                },
                "isConfigured": {
                    "type": "boolean",
                    "description": "Is the device configured"
                },
                "softwareVersion": {
                    "type": "number",
                    "format": "float32",
                    "description": "Software version"
                },
                "hardwareVersion": {
                    "type": "string",
                    "description": "Hardware version"
                },
                "isBleEnabled": {
                    "type": "boolean",
                    "description": "Is the bluetooth activate"
                },
                "temperature": {
                    "type": "integer",
                    "description": "Temperature"
                },
                "error": {
                    "type": "integer",
                    "description": "Error code value: 0 means no error"
                },
                "resetNumbers": {
                    "type": "integer",
                    "description": "Number of reset"
                },
                "initialSetupDate": {
                    "type": "number",
                    "format": "float64",
                    "description": "First installation date"
                },
                "lastResetDate": {
                    "type": "number",
                    "format": "float64",
                    "description": "Last reset date"
                },
                "brightness": {
                    "type": "integer",
                    "description": "Corrected Brightness in Lux"
                },
                "presence": {
                    "type": "boolean",
                    "description": "Presence"
                },
                "brigthnessCorrectionFactor": {
                    "type": "integer",
                    "description": "Brightness correction factor"
                },
                "thresoldPresence": {
                    "type": "integer",
                    "description": "Thresold presence"
                },
                "temperatureOffset": {
                    "type": "integer",
                    "description": "Temperature offset correcion"
                },
                "brigthnessRaw": {
                    "type": "integer",
                    "description": "Brigthness Raw value in Lux"
                },
                "lastMovement": {
                    "type": "integer",
                    "description": "Last Movement date"
                },
                "voltageInput": {
                    "type": "integer",
                    "description": "Input voltage"
                },
                "temperatureRaw": {
                    "type": "integer",
                    "description": "Temperature Raw value"
                },
                "friendlyName": {
                    "type": "string",
                    "description": "Sensor FriendlyName"
                }
            }
        },
        "LedStatus": {
            "type": "object",
            "required": [
                "mac"
            ],
            "properties": {
                "mac": {
                    "type": "string",
                    "description": "LED mac address"
                },
                "id": {
                    "type": "string"
                },
                "ip": {
                    "type": "string",
                    "description": "Led IP address"
                },
                "group": {
                    "type": "integer",
                    "description": "Associate group"
                },
                "protocol": {
                    "type": "string",
                    "description": "Sensor communication protocol"
                },
                "topic": {
                    "type": "string",
                    "description": "Sensor communication topic"
                },
                "switchMac": {
                    "type": "string",
                    "description": "Associate switch mac address"
                },
                "isConfigured": {
                    "type": "boolean",
                    "description": "Is the sensor configured"
                },
                "softwareVersion": {
                    "type": "number",
                    "format": "float32",
                    "description": "Sensor Software version"
                },
                "hardwareVersion": {
                    "type": "string",
                    "description": "Sensor Hardware version"
                },
                "isBleEnabled": {
                    "type": "boolean",
                    "description": "Is the bluetooth activate"
                },
                "temperature": {
                    "type": "integer",
                    "description": "On board temperature"
                },
                "error": {
                    "type": "integer",
                    "description": "Error code value: 0 means no error"
                },
                "resetNumbers": {
                    "type": "integer",
                    "description": "Number of reset"
                },
                "initialSetupDate": {
                    "type": "number",
                    "format": "float64",
                    "description": "First installation date"
                },
                "lastResetDate": {
                    "type": "number",
                    "format": "float64",
                    "description": "Last reset date"
                },
                "friendlyName": {
                    "type": "string",
                    "description": "Sensor FriendlyName"
                },
                "iMax": {
                    "type": "integer",
                    "description": "iMax"
                },
                "duration": {
                    "type": "number",
                    "format": "float64",
                    "description": "brightness duration"
                },
                "setpoint": {
                    "type": "integer",
                    "description": "Setpoint value in percentage"
                },
                "thresoldLow": {
                    "type": "integer",
                    "description": "Thresold low"
                },
                "thresoldHigh": {
                    "type": "integer",
                    "description": "Thresold high"
                },
                "daisyChainEnabled": {
                    "type": "boolean",
                    "description": "Daisy chained enabled"
                },
                "daisyChainPos": {
                    "type": "integer",
                    "description": "Daisy chained position"
                },
                "devicePower": {
                    "type": "integer",
                    "description": "Device power"
                },
                "energy": {
                    "type": "number",
                    "format": "float64",
                    "description": "Energy"
                },
                "voltageLed": {
                    "type": "integer",
                    "description": "Voltage LED"
                },
                "voltageInput": {
                    "type": "integer",
                    "description": "Voltage input"
                },
                "linePower": {
                    "type": "integer",
                    "description": "input line power"
                },
                "timeToAuto": {
                    "type": "integer",
                    "description": "remaining time to automatic mode in second"
                },
                "watchdog": {
                    "type": "integer",
                    "description": "watchdog in second"
                },
                "auto": {
                    "type": "boolean",
                    "description": "Automatic mode"
                }
            }
        },
        "Error": {
            "required": [
              "code",
              "message"
            ],
            "properties": {
              "code": {
                "type": "integer",
                "format": "int32"
              },
              "message": {
                "type": "string"
              }
            }
          }
    }
}